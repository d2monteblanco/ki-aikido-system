# Configuração Supervisor para Sistema Ki Aikido
# Local: /etc/supervisor/conf.d/ki-aikido.conf

[program:ki-aikido]
command=/opt/ki-aikido-system/backend/venv/bin/python3 /opt/ki-aikido-system/backend/src/main.py
directory=/opt/ki-aikido-system/backend
user=%(ENV_USER)s
autostart=true
autorestart=true
startretries=3
stopwaitsecs=10

# Variáveis de ambiente
environment=
    FLASK_ENV="production",
    PYTHONUNBUFFERED="1"

# Logs
stdout_logfile=/opt/ki-aikido-system/logs/app.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/opt/ki-aikido-system/logs/error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

# Não redirecionar stderr para stdout
redirect_stderr=false

# Prioridade de inicialização
priority=999

# Tempo de espera para startup
startsecs=5

# Sinais para parar processo
stopsignal=TERM
stopasgroup=true
killasgroup=true
